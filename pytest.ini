[pytest]
# ============================================================================
# Pytest Configuration for Kepler Exoplanet ML Project
# ============================================================================
# Author: sulegogh
# Date: 2025-11-13
# Version: 3.0 (Complete rewrite with all markers)
# ============================================================================

# ============================================================================
# TEST DISCOVERY
# ============================================================================
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# ============================================================================
# OUTPUT OPTIONS
# ============================================================================
addopts =
    -v
    --strict-markers
    --tb=short
    --disable-warnings
    --cov=src
    --cov-report=html
    --cov-report=term-missing
    --cov-fail-under=70
    --maxfail=5

# ============================================================================
# MARKERS FOR ORGANIZING TESTS
# ============================================================================
markers =
    unit: Unit tests (fast, isolated, single component)
    integration: Integration tests (multiple components)
    slow: Slow running tests (execution time > 1 second)
    fast: Fast running tests (execution time < 0.1 second)

    # Module-specific markers
    core: Core functionality tests (constants, exceptions, label utils)
    data: Data processing tests (cleaners, preprocessors, loaders)
    features: Feature engineering tests (engineering, scaling, selection)
    models: Model tests (training, prediction, persistence)
    evaluation: Evaluation and metrics tests
    pipeline: Pipeline integration tests (end-to-end workflows)

    # Component markers
    api: API endpoint tests
    cli: CLI command tests
    webapp: Web application tests

    # Special markers
    smoke: Smoke tests (critical functionality checks)
    regression: Regression tests
    performance: Performance tests
    security: Security tests

    # Data requirement markers
    requires_data: Tests that require external data files
    requires_model: Tests that require trained models
    requires_gpu: Tests that require GPU

    # Platform markers
    linux_only: Tests that only run on Linux
    windows_only: Tests that only run on Windows
    macos_only: Tests that only run on macOS

# ============================================================================
# ASYNCIO CONFIGURATION
# ============================================================================
asyncio_mode = strict

# ============================================================================
# WARNINGS FILTER
# ============================================================================
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::FutureWarning
    ignore::UserWarning:sklearn

# ============================================================================
# LOGGING
# ============================================================================
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] [%(filename)s:%(lineno)d] %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# ============================================================================
# TIMEOUT
# ============================================================================
# Uncomment if pytest-timeout is installed
# timeout = 300
# timeout_method = thread

# ============================================================================
# COVERAGE CONFIGURATION
# ============================================================================
[coverage:run]
source = src
omit =
    */tests/*
    */venv/*
    */__pycache__/*
    */site-packages/*
    */.pytest_cache/*
    */htmlcov/*
    */logs/*
    */.git/*
    */migrations/*
    */scripts/*

branch = True
parallel = False

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    def __str__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    if sys.version_info
    @abstractmethod
    @overload
    @abc.abstractmethod
    # pragma: no cover
    # type: ignore

precision = 2
show_missing = True
skip_covered = False
skip_empty = False

# Report thresholds
fail_under = 70

[coverage:html]
directory = htmlcov
title = Kepler Exoplanet ML - Test Coverage Report

[coverage:json]
output = coverage.json
pretty_print = true

# ============================================================================
# END OF CONFIGURATION
# ============================================================================
