# ==========================================================
# KEPLER EXOPLANET ML PROJECT: AUTOMATED QUALITY GATE
# ==========================================================
# Bu dosya, `git commit` öncesi tüm kalite kontrollerini
# (format, lint, type, security) otomatik olarak çalıştırır.
#
# Kurallar (line-length, ignore vb.) 'pyproject.toml'
# dosyasından merkezi olarak okunur.
#
# Updated: 2025-11-11 18:46:13 UTC
# Author: sulegogh
# Version: 2.0 (Pre-commit 3.x compatible)
# ==========================================================

# Pre-commit yapılandırması
default_language_version:
  python: python3.10

# Hangi dosyaları kontrol etmeyeceğiz
exclude: |
  (?x)^(
      .*\.egg-info/.*|
      .*/__pycache__/.*|
      .*\.pyc|
      .*\.pyo|
      .*/\.git/.*|
      .*/\.tox/.*|
      .*/\.pytest_cache/.*|
      .*/\.mypy_cache/.*|
      .*\.ipynb_checkpoints/.*|
      venv/.*|
      env/.*|
      data/raw/.*|
      data/processed/.*|
      data/engineered/.*|
      data/scaled/.*|
      data/selected/.*|
      models/.*\.pkl|
      models/.*\.joblib|
      logs/.*|
      catboost_info/.*
  )$

repos:
  # --------------------------------------------------------
  # TEMEL KANCALAR (Genel dosya kontrolleri)
  # --------------------------------------------------------
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # --- Dosya Bütünlüğü ---
      - id: trailing-whitespace
        name: Trim Trailing Whitespace
        args: [--markdown-linebreak-ext=md]
        
      - id: end-of-file-fixer
        name: Fix End of Files
        
      - id: mixed-line-ending
        name: Fix Line Endings
        args: [--fix=lf]
        
      - id: check-merge-conflict
        name: Check for Merge Conflicts
        
      - id: check-case-conflict
        name: Check for Case Conflicts
        
      - id: check-docstring-first
        name: Check Docstring First

      # --- Yapılandırma Dosyaları ---
      - id: check-yaml
        name: Check YAML Syntax
        args: [--safe]
        exclude: ^\.pre-commit-config\.yaml$  # Self-check skip
        
      - id: check-json
        name: Check JSON Syntax
        
      - id: check-toml
        name: Check TOML Syntax

      # --- Güvenlik & Veri Sızıntısı Engelleme ---
      - id: check-added-large-files
        name: Check Large Files (>10MB)
        args: ['--maxkb=10000']  # 10MB limit
        exclude: |
          (?x)^(
              data/.*\.csv|
              models/.*\.pkl|
              models/.*\.joblib
          )$
        
      - id: detect-private-key
        name: Detect Private Keys
        
      - id: check-ast
        name: Check Python AST
        
      - id: debug-statements
        name: Check Debug Statements

  # --------------------------------------------------------
  # KOD FORMATLAMA (Black & isort)
  # --------------------------------------------------------
  - repo: https://github.com/psf/black
    rev: 23.12.1
    hooks:
      - id: black
        name: Format with Black
        language_version: python3.10
        # NO stages: Pre-commit 3.x uses [commit] by default
        # Kurallar 'pyproject.toml' [tool.black] bölümünden okunur

  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        name: Sort Imports with isort
        # Kurallar 'pyproject.toml' [tool.isort] bölümünden okunur

  # --------------------------------------------------------
  # KOD DENETLEME (Flake8 Linter)
  # --------------------------------------------------------
  - repo: https://github.com/pycqa/flake8
    rev: 7.0.0
    hooks:
      - id: flake8
        name: Lint with Flake8
        # Kurallar 'pyproject.toml' [tool.flake8] bölümünden okunur
        additional_dependencies:
          - flake8-docstrings>=1.7.0
          - flake8-bugbear>=23.12.2
          - flake8-comprehensions>=3.14.0
          - flake8-simplify>=0.21.0
          - pep8-naming>=0.13.3

  # --------------------------------------------------------
  # STATİK TİP KONTROLÜ (MyPy)
  # --------------------------------------------------------
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        name: Type Check with MyPy
        # Kurallar 'pyproject.toml' [tool.mypy] bölümünden okunur
        additional_dependencies:
          - types-requests>=2.31.0
          - types-PyYAML>=6.0.12
          - types-python-dateutil>=2.8.19
          - pandas-stubs>=2.1.1
          - numpy>=1.24.0
        args:
          - --ignore-missing-imports
          - --no-strict-optional
        exclude: |
          (?x)^(
              tests/.*|
              notebooks/.*
          )$

  # --------------------------------------------------------
  # JUPYTER NOTEBOOK KALİTESİ (nbQA)
  # --------------------------------------------------------
  - repo: https://github.com/nbQA-dev/nbQA
    rev: 1.7.1
    hooks:
      - id: nbqa-black
        name: Format Notebooks with Black
        # Kurallar 'pyproject.toml' [tool.black] ayarlarını kullanır
        
      - id: nbqa-isort
        name: Sort Notebook Imports
        # Kurallar 'pyproject.toml' [tool.isort] ayarlarını kullanır
        
      - id: nbqa-flake8
        name: Lint Notebooks with Flake8
        # Kurallar 'pyproject.toml' [tool.flake8] ayarlarını kullanır
        additional_dependencies:
          - flake8-docstrings
          - flake8-bugbear
          - flake8-comprehensions

  # --------------------------------------------------------
  # PYTHON GÜNCELLEME KONTROL (pyupgrade)
  # --------------------------------------------------------
  - repo: https://github.com/asottile/pyupgrade
    rev: v3.15.0
    hooks:
      - id: pyupgrade
        name: Upgrade Python Syntax
        args: [--py310-plus]  # Python 3.10+ syntax

  # --------------------------------------------------------
  # DOKÜMANTasyon KALİTESİ (pydocstyle)
  # --------------------------------------------------------
  - repo: https://github.com/pycqa/pydocstyle
    rev: 6.3.0
    hooks:
      - id: pydocstyle
        name: Check Docstring Style
        args:
          - --convention=google
          - --add-ignore=D100,D104,D107  # Eksik docstring'leri yumuşat
        exclude: |
          (?x)^(
              tests/.*|
              setup\.py
          )$

  # --------------------------------------------------------
  # YAML/JSON FORMATLAMA
  # --------------------------------------------------------
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v3.1.0
    hooks:
      - id: prettier
        name: Format YAML/JSON/Markdown
        types_or: [yaml, json, markdown]
        exclude: |
          (?x)^(
              \.pre-commit-config\.yaml|
              data/.*
          )$

# ==========================================================
# CI/CD ORTAMI İÇİN
# ==========================================================
# CI ortamında tüm hook'ları atlamak için:
#   SKIP=... git commit -m "..."
#
# Belirli hook'ları atlamak için:
#   SKIP=black,flake8 git commit -m "..."
#
# Pre-commit'i tamamen bypass etmek için:
#   git commit --no-verify -m "..."
# ==========================================================